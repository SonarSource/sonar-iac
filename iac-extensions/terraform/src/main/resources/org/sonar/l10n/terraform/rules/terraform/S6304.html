<p>A policy that allows identities to access all resources in an AWS account may violates <a
href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account:</p>
<ul>
  <li> has more than one resource with different levels of sensitivity. </li>
</ul>
<p>There is a risk if you answered yes to any of this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Itâ€™s recommended to apply the least privilege principle, i.e. by only granting access to necessary resources. A good practice to achieve this is to
organize or <a
href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Noncompliant Code Example</h2>
<p>Update permission is granted for all policies using the wildcard (*) in the <code>Resource</code> property:</p>
<pre>
resource "aws_iam_policy" "noncompliantpolicy" {
  name        = "noncompliantpolicy"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "iam:CreatePolicyVersion"
        ]
        Effect   = "Allow"
        Resource = [
          "*" # Sensitive
        ]
      }
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>Restrict update permission to the appropriate subset of policies:</p>
<pre>
resource "aws_iam_policy" "compliantpolicy" {
  name        = "compliantpolicy"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "iam:CreatePolicyVersion"
        ]
        Effect   = "Allow"
        Resource = [
          "arn:aws:iam::${data.aws_caller_identity.current.account_id}:policy/team1/*"
        ]
      }
    ]
  })
}
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">AWS Documentation</a> - Grant least
  privilege </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/732.html">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li>
  <li> <a href="https://cwe.mitre.org/data/definitions/284.html">MITRE, CWE-284</a> - Improper Access Control </li>
  <li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li>
</ul>


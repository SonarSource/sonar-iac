<p>Docker offers a feature to mount files and directories for specific <code>RUN</code> instructions when building Docker images. This feature can be
used to provide secrets to the commands that are executed during the build without baking them into the image. Additionally, it can be used to access
SSH agents during the build.</p>
<p>By using the <code>mode</code> option the permissions of the secrets or agents can be modified. By default, access is limited to the root user.</p>
<p>When such secrets are exposed with lax permissions, they might get compromised during the image build process. A successful compromise can only
happen during the execution of the command the <code>mount</code> option has been added to. While this might seem like a very hard exploitation
requirement, supply chain attacks, and other related threats, should still be considered.</p>
<p>If you are executing a command as a low-privileged user and need to access secrets or agents, you can use the options <code>uid</code> and
<code>gid</code> to provide access without having to resort to world-readable or writable permissions that might expose them to unintended
parties.</p>
<h2>Noncompliant Code Example</h2>
<pre>
RUN --mount=type=secret,id=build_secret,mode=0777 ./installer.sh # Noncompliant
</pre>
<h2>Compliant Solution</h2>
<pre>
RUN --mount=type=secret,id=build_secret,uid=1000 ./installer.sh
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://cwe.mitre.org/data/definitions/732">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li>
  <li> <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">Dockerfile reference</a> - RUN --mount </li>
</ul>

